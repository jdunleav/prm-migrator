version: 0.2

phases:
  install:
    commands:
      - apt-get update
      - apt-get install -y jq zip unzip
      - wget -q https://releases.hashicorp.com/terraform/0.11.10/terraform_0.11.10_linux_amd64.zip
      - unzip terraform_0.11.10_linux_amd64.zip -d /bin
      - chmod +x /bin/terraform
      - wget -q https://github.com/gruntwork-io/terragrunt/releases/download/v0.17.3/terragrunt_linux_amd64 -O /bin/terragrunt
      - chmod +x /bin/terragrunt
  pre_build:
    commands:
      - export ASSUME_ROLE_NAME=arn:aws:iam::431593652018:role/PASTASLOTHVULGAR
      - export TERRAGRUNT_IAM_ROLE=$ASSUME_ROLE_NAME
      - eval $(./utils/aws-cli-assumerole.sh -r $ASSUME_ROLE_NAME)
  build:
    commands:
      - touch terraform.tfvars
#      - terragrunt init --terragrunt-working-dir ./terragrunt/account/431593652018/dev/lambdas
#      - terragrunt validate --terragrunt-working-dir ./terragrunt/account/431593652018/dev/lambdas
#      - terragrunt apply -auto-approve --terragrunt-working-dir ./terragrunt/account/431593652018/dev/lambdas

